  <xmodel version="2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:noNamespaceSchemaLocation='http://flame.ac.uk/schema/xmml_v2.xsd'>
     
  <name>Dormant Cancer Cells</name>
  <author>Christine Seeliger</author>
  <description>Main file for dormant Cancer cell model</description>
  <version>1</version>
  
	<environment>
		
		<functionFiles>
			<file>ob.c</file>
			<file>oc.c</file>
			<file>dcc.c</file>
			<file>ps.c</file>
		</functionFiles>
		
		<constants>
			<variable>
				<description>The size of the world in gridunits</description>
				<name>worldsize</name>
				<type>int</type>
			</variable> 
			<variable>
				<description>Gives how many micrometer one gridcell is</description>
				<name>unitum</name>
				<type>int</type>
			</variable>
			<variable>
				<description>Speed of an Osteoclast in Gridcell units</description>
				<name>OC_speed</name>
				<type>int</type>
			</variable>
		</constants>
		
		<timeUnits>
			<timeUnit>
				<name>minute</name>
				<unit>iteration</unit>
				<period>1</period>
			</timeUnit>
			<timeUnit>
				<name>hour</name>
				<unit>minute</unit>
				<period>60</period>
			</timeUnit>
			<timeUnit>
				<name>day</name>
				<unit>hour</unit>
				<period>24</period>
			</timeUnit>
		</timeUnits>
		
		<dataTypes>
			<dataType>
				<name>gridcell</name>
				<variables>
					<variable>
						<description>x coordinate of cell (upper left corner)</description>
						<name>xcoord</name>
						<type>int</type>
					</variable>
					<variable>
						<description>y coordinate of cell (upper left corner)</description>
						<name>ycoord</name>
						<type>int</type>
					</variable>
					<variable>
						<description>width of the cell</description>
						<name>length</name>
						<type>int</type>
					</variable>
				</variables>
			</dataType>
			
			<dataType>
				<name>ps</name>
				<variables>
					<variable>
						<description>X coordinate of the source centre</description>
						<name>locationx</name>
						<type>int</type>
					</variable>
					<variable>
						<description>Y coordinate of the source centre</description>
						<name>locationy</name>
						<type>int</type>
					</variable>
					<variable>
						<description>Baseline concentration, everything below will cause the source to cease existence</description>
						<name>base_conc</name>
						<type>double</type>
					</variable>
					<variable>
						<description>Max concentration at the centre of source</description>
						<name>max_conc</name>
						<type>double</type>
					</variable>
					<variable>
						<description>Current concentration at the centre of source</description>
						<name>current_conc</name>
						<type>double</type>
					</variable>
					<variable>
						<description>Exponent for the decay function (atm exponential)</description>
						<name>decay_exp</name>
						<type>double</type>
					</variable>
					<variable>
						<description>Exponent for the gradient function calculation</description>
						<name>gradient_power</name>
						<type>int</type>
					</variable>
					<variable>
						<description>lifetime in minutes since source started signaling</description>
						<name>lifetime</name>
						<type>int</type>
					</variable>
				</variables>
			</dataType>
			</dataTypes>
		</environment>
	
	<agents>
	<xagent>
		<description>Dormant Cancer Cell Agent</description>
			<name>dcc</name>
			
			<memory>
				<variable>
					<description>
						The cells DiD MFI fluorescence, should go down with divisions.
					</description>
					<name>DiD_MFI</name>
					<type>int</type>
				</variable>
				<variable>
					<description>
						The cells geometrical properties (position in space and diameter)
					</description>
					<name>geo</name>
					<type>gridcell</type>
				</variable>
				<variable>
					<description>
						1 if cell is dormant. 0 otherwise.
					</description>
					<name>dormant</name>
					<type>int</type>
				</variable>
			</memory>
			
			<functions>
				<function>
					<name>respond</name>
					<condition>
						<lhs>
							<value>a.dormant</value>
						</lhs>
						<op>EQ</op>
						<rhs>
							<value>1</value>
						</rhs>
					</condition>
					<currentState>start</currentState>
					<nextState>end</nextState>
					<inputs>
						<input><messageName>position</messageName></input>
					</inputs>
				</function>
				<function>
					<name>divide</name>
					<inputs>
						<input><messageName>position</messageName></input>
					</inputs>
					<condition>					
						<lhs><value>a.dormant</value></lhs>
						<op>EQ</op>
						<rhs>
							<value>0</value>
						</rhs>
					</condition>
					<currentState>start</currentState>
					<nextState>end</nextState>
					
				</function>
			</functions>
</xagent>
<xagent>
	<description>Osteoblast Cell Agent</description>
			<name>ob</name>
			<memory>
				<variable>
					<description>
						The cells geometrical properties (position in space and diameter)
					</description>
					<name>geo</name>
					<type>gridcell</type>
				</variable>
				<variable>
					<name>celltype</name>
					<type>int</type>
				</variable>
			</memory>
			
			<functions> 
				<function>
					<name>signal_ob_position</name>
					<currentState>start</currentState>
					<nextState>moving</nextState>
					<outputs>
						<output><messageName>position</messageName></output>
					</outputs>
				</function>
				<function>
					<name>move</name>
					<currentState>moving</currentState>
					<nextState>end</nextState>
					<inputs>
						<input>
							<messageName>pointsource</messageName>
						</input>
					</inputs>
				</function>
			</functions>
		</xagent> 
		
		<xagent>
     	<description>Osteoclast Cell Agent</description>
			<name>oc</name>
			<memory>
				<variable>
					<name>id</name>
					<type>char</type>
				</variable>
				<variable>
					<description>
						The cells geometrical properties (position in space and diameter)
					</description>
					<name>geo</name>
					<type>gridcell</type>
				</variable> 
			</memory>
			
			<functions>
				<function>
					<name>signal_oc_position</name>
					<currentState>signal</currentState>
					<nextState>end</nextState>
					<outputs>
						<output><messageName>position</messageName></output>
					</outputs>
				</function>
			
			<function>
				<name>move</name>
				<currentState>start</currentState>
				<nextState>signal</nextState>
				<inputs>
					<input>
						<messageName>pointsource</messageName>
					</input>
				</inputs>
			</function>
				
			</functions>
		</xagent>
		
		<xagent>
			<name>pointsource</name>
			<description>Location and parameters of pointsources for factor release</description>
			
			<memory>
				<variable>
					<description>Description of the pointsource, aka location, concentrations,...</description>
					<name>descrip</name>
					<type>ps</type>
				</variable>
				<variable>
					<description>0 if pointsource is inactive atm</description>
					<name>active</name>
					<type>int</type>
				</variable>
				<variable>
					<description>Timepoint when source comes to life</description>
					<name>source_start</name>
					<type>int</type>
				</variable>
			</memory>
			
			<functions>
			<function>
				<name>init</name>
				<currentState>start</currentState>
				<nextState>signal</nextState>
				<condition>
					<time>
						<period>minute</period>
						<phase>a.source_start</phase>
					</time>
				</condition>
			</function>
		 	<function>
		 		<name>decay</name>
		 		<condition>
		 			<lhs><value>a.active</value></lhs>
		 			<op>EQ</op>
		 			<rhs><value>1</value></rhs>
		 		</condition>
		 		<description>Changes the source concentration over time</description>
		 		<currentState>start</currentState>
		 		<nextState>signal</nextState>
		 	</function>
		 	<function>
		 		<name>inactive</name>
		 		<condition>
		 			<lhs><value>a.active</value></lhs>
		 			<op>EQ</op>
		 			<rhs><value>0</value></rhs>
		 		</condition>
		 		<description>Does nothing</description>
		 		<currentState>start</currentState>
		 		<nextState>end</nextState>
		 	</function>
		 	<function>
		 		<name>signal</name>
		 		<description>Signals properties of pointsource</description>
		 		<currentState>signal</currentState>
		 		<nextState>increase_lifetime</nextState>
		 		<outputs>
		 			<output>
		 				<messageName>pointsource</messageName>
		 			</output>
		 		</outputs>
		 	</function>
		 	<function>
		 		<name>increase_lifetime</name>
		 		<description>Updates the lifetime of and active pointsource</description>
		 		<currentState>increase_lifetime</currentState>
		 		<nextState>end</nextState>
		 	</function>
			</functions>
		</xagent>
	
	</agents>
	
	<messages>
		<message>
			<name>pointsource</name>
			<variables>
				<variable>
					<name>location</name>
					<type>ps</type>
				</variable>
			</variables>
		</message>	
		<message>
			<name>position</name>
			<variables>
				<variable>
					<name>geo</name>
					<type>gridcell</type>
				</variable>
				<variable>
					<name>celltype</name>
					<type>int</type>
				</variable>
			</variables>
		</message>
	</messages>
</xmodel>