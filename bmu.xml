<xmodel version="2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:noNamespaceSchemaLocation='http://flame.ac.uk/schema/xmml_v2.xsd'>

  <name>Dormant Cancer Cells</name>
  <author>Christine Seeliger</author>
  <description>Dormant Cancer cell model with cell based BMU concept</description>
  <version>1</version>

	<environment>

		<functionFiles>
			<file>oc.c</file>
			<file>ob.c</file>
			<file>bmu.c</file>
			<file>environment.c</file>
		</functionFiles>

		<constants>
			<variable>
				<description>The size of the world in gridunits</description>
				<name>worldsize</name>
				<type>int</type>
			</variable>
			<variable>
				<name>oc_lifespan</name>
				<type>int</type>
			</variable>
			<variable>
				<name>ob_lifespan</name>
				<type>int</type>
			</variable>
			<variable>
				<name>bmu_lifespan</name>
				<type>int</type>
			</variable>
			<variable>
				<name>bmu_av_speed</name>
				<type>double</type>
			</variable>
			<variable>
				<name>oc_creation_freq</name>
				<type>double</type>
			</variable>
			<variable>
				<name>ob_creation_freq</name>
				<type>double</type>
			</variable>
			<variable>
				<name>oc_diameter</name>
				<type>double</type>
			</variable>
			<variable>
				<name>ob_diameter</name>
				<type>double</type>
			</variable>
			<variable>
				<name>oc_type</name>
				<type>int</type>
			</variable>
			<variable>
				<name>ob_type</name>
				<type>int</type>
			</variable>
			<variable>
				<name>bmu_type</name>
				<type>int</type>
			</variable>
			<variable>
				<name>oc_speed</name>
				<type>double</type>
			</variable>
			<variable>
				<name>oc_displ_stdev</name>
				<type>double</type>
			</variable>
			<variable>
				<name>oc_max_nuclei</name>
				<type>int</type>
			</variable>
			<variable>
				<name>oc_max_frontdist</name>
				<type>int</type>
			</variable>
			<variable>
				<name>oc_speed_damp</name>
				<type>double</type>
			</variable>
			<variable>
				<name>oc_resorb</name>
				<type>double</type>
			</variable>
			<variable>
				<name>ob_synth</name>
				<type>double</type>
			</variable>
		</constants>

		<timeUnits>
			<timeUnit>
				<name>minute</name>
				<unit>iteration</unit>
				<period>1</period>
			</timeUnit>
			<timeUnit>
				<name>hour</name>
				<unit>minute</unit>
				<period>60</period>
			</timeUnit>
			<timeUnit>
				<name>day</name>
				<unit>hour</unit>
				<period>24</period>
			</timeUnit>
		</timeUnits>

		<dataTypes>
			<dataType>
				<name>coordinate</name>
				<variables>
					<variable>
						<name>x</name>
						<type>double</type>
					</variable>
					<variable>
						<name>y</name>
						<type>double</type>
					</variable>
				</variables>
			</dataType>
			<dataType>
				<name>celldim</name>
				<variables>
					<variable>
						<description>position</description>
						<name>xy</name>
						<type>coordinate</type>
					</variable>
					<variable>
						<description>Diameter of the cell</description>
						<name>diameter</name>
						<type>double</type>
					</variable>
					<variable>
						<name>nuclei</name>
						<type>int</type>
					</variable>
				</variables>
			</dataType>
			<dataType>
				<name>dim_id</name>
				<variables>
					<variable>
						<name>dims</name>
						<type>celldim</type>
					</variable>
					<variable>
						<name>id</name>
						<type>int</type>
					</variable>
				</variables>
			</dataType>
			<dataType>
				<name>fusion_pair</name>
				<variables>
					<variable>
						<name>id1</name>
						<type>int</type>
					</variable>
					<variable>
						<name>dim1</name>
						<type>celldim</type>
					</variable>
					<variable>
						<name>id2</name>
						<type>int</type>
					</variable>
					<variable>
						<name>dim2</name>
						<type>celldim</type>
					</variable>
					<variable>
						<name>overlap</name>
						<type>double</type>
					</variable>
				</variables>
			</dataType>
		</dataTypes>

	</environment>

	<agents>

<!-- OSTEOCLAST AGENT -->
		<xagent>
			<name>oc</name>
			<memory>
				<variable>
					<name>oc_dim</name>
					<type>celldim</type>
				</variable>
				<variable>
					<name>oc_age</name>
					<type>int</type>
				</variable>
				<variable>
					<name>oc_id</name>
					<type>int</type>
				</variable>
				<variable>
					<name>oc_death_prob</name>
					<type>double</type>
				</variable>
				<variable>
					<name>oc_mybmu</name>
					<type>int</type>
				</variable>
				<variable>
					<name>oc_direction</name>
					<type>coordinate</type>
				</variable>
			</memory>

			<functions>
				<function>
					<name>initialize_oc</name>
					<currentState>start</currentState>
					<nextState>end</nextState>
					<condition>
						<lhs><value>a.oc_age</value></lhs>
						<op>EQ</op>
						<rhs><value>0</value></rhs>
					</condition>
				</function>
				<function>
					<name>signal_oc_position</name>
					<currentState>start</currentState>
					<nextState>1</nextState>
					<condition>
						<lhs><value>a.oc_age</value></lhs>
						<op>GT</op>
						<rhs><value>0</value></rhs>
					</condition>
					<outputs>
						<output>
							<messageName>oc_position</messageName>
						</output>
					</outputs>
				</function>
				<function>
					<name>fuse</name>
					<currentState>1</currentState>
					<nextState>2</nextState>
					<inputs>
						<input>
							<messageName>fusion_signal</messageName>
						</input>
					</inputs>
				</function>
				<function>
					<name>oc_move</name>
					<currentState>2</currentState>
					<nextState>3</nextState>
					<inputs>
						<input>
							<messageName>bmu_position</messageName>
						</input>
					</inputs>
				</function>
				<function>
					<name>signal_oc_updated_position</name>
					<currentState>3</currentState>
					<nextState>4</nextState>
					<condition>
						<lhs><value>a.oc_age</value></lhs>
						<op>GT</op>
						<rhs><value>0</value></rhs>
					</condition>
					<outputs>
						<output>
							<messageName>oc_updated_position</messageName>
						</output>
					</outputs>
				</function>
				<function>
					<name>oc_update_position</name>
					<currentState>4</currentState>
					<nextState>5</nextState>
					<inputs>
						<input>
							<messageName>new_oc_position</messageName>
						</input>
					</inputs>
				</function>
				<function>
					<name>oc_get_older</name>
					<currentState>5</currentState>
					<nextState>6</nextState>
				</function>
				<function>
					<name>oc_die</name>
					<currentState>6</currentState>
					<nextState>end</nextState>
					<outputs>
						<output>
							<messageName>death</messageName>
						</output>
					</outputs>
				</function>
			</functions>
		</xagent>

		<!-- BASIC MULTICELLULAR UNIT -->
		<xagent>
			<name>bmu</name>
			<memory>
				<variable>
					<name>bmu_id</name>
					<type>int</type>
				</variable>
				<variable>
					<name>bmu_direction</name>
					<type>coordinate</type>
				</variable>
				<variable>
					<name>bmu_speed</name>
					<type>double</type>
				</variable>
				<variable>
					<name>bmu_position</name>
					<type>coordinate</type>
				</variable>
				<variable>
					<name>bmu_length</name>
					<type>int</type>
				</variable>
				<variable>
					<name>bmu_age</name>
					<type>int</type>
				</variable>
				<variable>
					<name>bmu_width</name>
					<type>int</type>
				</variable>
				<variable>
					<name>oc_present</name>
					<type>int</type>
				</variable>
				<variable>
					<name>ob_present</name>
					<type>int</type>
				</variable>
				<variable>
					<name>z</name>
					<type>double</type>
				</variable>
			</memory>
			<functions>
				<function>
					<name>create</name>
					<currentState>start</currentState>
					<nextState>1</nextState>
				</function>
				<function>
					<name>signal_position</name>
					<currentState>1</currentState>
					<nextState>2</nextState>
					<outputs>
						<output>
							<messageName>bmu_position</messageName>
						</output>
					</outputs>
				</function>
				<function>
					<name>bmu_die</name>
					<currentState>2</currentState>
					<nextState>3</nextState>
				</function>
				<function>
					<name>ob_push_check</name>
					<currentState>3</currentState>
					<nextState>4</nextState>
					<inputs>
						<input>
							<messageName>ob_position</messageName>
						</input>
					</inputs>
					<outputs>
						<output>
							<messageName>new_ob_position</messageName>
						</output>
					</outputs>
				</function>
				<function>
					<name>calc_fusions</name>
					<currentState>4</currentState>
					<nextState>5</nextState>
					<inputs>
						<input>
							<messageName>oc_position</messageName>
						</input>
					</inputs>
					<outputs>
						<output>
							<messageName>fusion_signal</messageName>
						</output>
					</outputs>
				</function>
				<function>
					<name>oc_push_check</name>
					<currentState>5</currentState>
					<nextState>6</nextState>
					<inputs>
						<input>
							<messageName>oc_updated_position</messageName>
						</input>
					</inputs>
					<outputs>
						<output>
							<messageName>new_oc_position</messageName>
						</output>
					</outputs>
				</function>
				<function>
					<name>bmu_move</name>
					<currentState>6</currentState>
					<nextState>7</nextState>
				</function>
				<function>
					<name>bmu_update_data</name>
					<currentState>7</currentState>
					<nextState>end</nextState>
					<inputs>
						<input>
							<messageName>death</messageName>
						</input>
					</inputs>
				</function>
			</functions>
		</xagent>

<xagent>
	<name>dcc</name>
	<memory>
		<variable>
			<name>oc_neighbours</name>
			<type>int</type>
		</variable>
		<variable>
			<name>ob_neighbours</name>
			<type>int</type>
		</variable>
		<variable>
			<name>threshold</name>
			<type>double</type>
		</variable>
	</memory>
	<functions>
	</functions>
</xagent>

<!-- OSTEOBLAST AGENT -->
		<xagent>
			<name>ob</name>
			<memory>
				<variable>
					<name>ob_dim</name>
					<type>celldim</type>
				</variable>
				<variable>
					<name>ob_age</name>
					<type>int</type>
				</variable>
				<variable>
					<name>ob_id</name>
					<type>int</type>
				</variable>
				<variable>
					<name>ob_death_prob</name>
					<type>double</type>
				</variable>
				<variable>
					<name>ob_mybmu</name>
					<type>int</type>
				</variable>
				<variable>
					<name>ob_direction</name>
					<type>coordinate</type>
				</variable>
				<variable>
					<name>ob_moved_flag</name>
					<type>int</type>
				</variable>
			</memory>

			<functions>
				<function>
					<name>initialize_ob</name>
					<currentState>start</currentState>
					<nextState>end</nextState>
					<condition>
						<lhs><value>a.ob_age</value></lhs>
						<op>EQ</op>
						<rhs><value>0</value></rhs>
					</condition>
				</function>
				<function>
					<name>signal_ob_position</name>
					<currentState>start</currentState>
					<nextState>1</nextState>
					<condition>
						<lhs><value>a.ob_age</value></lhs>
						<op>GT</op>
						<rhs><value>0</value></rhs>
					</condition>
					<outputs>
						<output>
							<messageName>ob_position</messageName>
						</output>
					</outputs>
				</function>
				<function>
					<name>ob_move</name>
					<currentState>1</currentState>
					<nextState>2</nextState>
					<inputs>
						<input>
							<messageName>new_ob_position</messageName>
						</input>
					</inputs>
				</function>
				<function>
					<name>ob_get_older</name>
					<currentState>2</currentState>
					<nextState>3</nextState>
				</function>
				<function>
					<name>ob_die</name>
					<currentState>3</currentState>
					<nextState>end</nextState>
					<outputs>
						<output>
							<messageName>death</messageName>
						</output>
					</outputs>
				</function>
			</functions>
		</xagent>



<!-- ENVIRONMENT -->
		<xagent>
			<name>environment</name>
			<memory>
				<variable>
					<name>rand_init</name>
					<type>int</type>
				</variable>
				<variable>
					<name>bmu_freq</name>
					<type>double</type>
				</variable>
			</memory>
			<functions>
				<function>
					<name>initialize</name>
					<currentState>start</currentState>
					<nextState>end</nextState>
					<condition>
						<lhs>
							<value>a.rand_init</value>
						</lhs>
						<op>EQ</op>
						<rhs>
							<value>0</value>
						</rhs>
					</condition>
				</function>
				<function>
					<name>gen_bmus</name>
					<currentState>start</currentState>
					<nextState>end</nextState>
					<condition>
						<lhs>
							<value>a.rand_init</value>
						</lhs>
						<op>GT</op>
						<rhs>
							<value>0</value>
						</rhs>
					</condition>
				</function>
			</functions>
		</xagent>
	</agents>

<!--  MESSAGES -->
	<messages>
		<message>
			<name>oc_position</name>
			<variables>
				<variable>
					<name>oc_dimension</name>
					<type>celldim</type>
				</variable>
				<variable>
					<name>id</name>
					<type>int</type>
				</variable>
				<variable>
					<name>bmu_scope</name>
					<type>int</type>
				</variable>
			</variables>
		</message>
		<message>
			<name>oc_updated_position</name>
			<variables>
				<variable>
					<name>oc_dimension</name>
					<type>celldim</type>
				</variable>
				<variable>
					<name>id</name>
					<type>int</type>
				</variable>
				<variable>
					<name>bmu_scope</name>
					<type>int</type>
				</variable>
			</variables>
		</message>
		<message>
			<name>ob_position</name>
			<variables>
				<variable>
					<name>ob_dimension</name>
					<type>celldim</type>
				</variable>
				<variable>
					<name>id</name>
					<type>int</type>
				</variable>
			</variables>
		</message>
		<message>
			<name>fusion_signal</name>
			<variables>
				<variable>
					<name>id1</name>
					<type>int</type>
				</variable>
				<variable>
					<name>f_signal</name>
					<type>int</type>
				</variable>
				<variable>
					<name>f_bmu_id</name>
					<type>int</type>
				</variable>
				<variable>
					<name>f_nuclei</name>
					<type>int</type>
				</variable>
				<variable>
					<name>second_diameter</name>
					<type>double</type>
				</variable>
			</variables>
		</message>
		<message>
			<name>new_ob_position</name>
			<variables>
			<variable>
				<name>push_id</name>
				<type>int</type>
			</variable>
			<variable>
				<name>dims</name>
				<type>celldim</type>
			</variable>
			</variables>
		</message>
			<message>
			<name>new_oc_position</name>
			<variables>
			<variable>
				<name>push_id</name>
				<type>int</type>
			</variable>
			<variable>
				<name>dims</name>
				<type>celldim</type>
			</variable>
			</variables>
		</message>
		<message>
			<name>bmu_position</name>
			<variables>
				<variable>
					<name>bmu_pos</name>
					<type>coordinate</type>
				</variable>
				<variable>
					<name>bmu_id</name>
					<type>int</type>
				</variable>
			</variables>
		</message>
		<message>
			<name>death</name>
			<variables>
				<variable>
					<name>bmu_id</name>
					<type>int</type>
				</variable>
				<variable>
					<name>celltype</name>
					<type>int</type>
				</variable>
			</variables>
		</message>
	</messages>

</xmodel>
